<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <div id="app">
      <h1>SVG</h1>
      <h1>Image</h1>

      <div>
        <canvas ref="canvas" width="500" height="250"></canvas>
      </div>
      <div>
        <img :src="imageFile" alt="" width="500" height="250" />
      </div>

      <div>
        <input type="text" v-model="fillColor" />
        <input type="text" v-model="strokeColor" />
      </div>
    </div>

    <script>
      const { createApp } = Vue;

      createApp({
        data() {
          return {
            imageFile: undefined,

            fillColor: "green",
            strokeColor: "blue",
          };
        },
        computed: {
          svgString() {
            return `
      <svg viewBox="15 220 80 20" width="500" height="250" version="1.1" xmlns="http://www.w3.org/2000/svg">
        <path d="M20,230 Q40,205 50,230 T90,230" fill="${this.fillColor}" stroke="${this.strokeColor}" stroke-width="5"/>
      </svg>
                  `;
          },
        },
        watch: {
          svgString() {
            this.renderSvg();
          },
        },
        mounted() {
          this.renderSvg();
        },
        methods: {
          renderSvg() {
            //https://stackoverflow.com/questions/72011260/draw-svg-with-dynamic-value-on-canvas
            const image = new Image();
            const context = this.$refs.canvas.getContext("2d");

            image.src = `data:image/svg+xml;base64,${window.btoa(
              this.svgString
            )}`;

            image.onload = () => {
              context.drawImage(image, 0, 0);

              // Render image
              this.imageFile = this.$refs.canvas.toDataURL("image/png");
            };
          },
        },
      }).mount("#app");
    </script>

    <style>
      #app {
        width: 100%;
        height: 100%;
        display: grid;
        grid-template: auto 1fr auto / 1fr 1fr;
      }

      #app > * {
        margin: 20px;
        padding: 20px;
      }

      #app > div {
        border: dotted 1px #ccc;
      }
    </style>
  </body>
</html>
